<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE elasticMapper SYSTEM "elasticmapping.dtd">
<elasticMapper name="lisitem" desc="导入检验数据" business="ls">
    <propertys>
        <!--检验ID-->
        <property sourceName="inspection_id" targetName="ls_lis_id" valueType="String" idField="true" >
            <concatValueConvertor methodName="concatValue">
                <parameter>inspection_id</parameter>
                <parameter>test_item_id</parameter>
            </concatValueConvertor>
        </property>
        <property sourceName="lis_admno" targetName="admno" valueType="String" rowKey="true" parentField="true"></property>
        <property sourceName="lis_regno" targetName="regno" valueType="String" routingField="true"></property>
        <!--检验名称-->
        <property sourceName="lis_name" targetName="ls_lis_name" valueType="String">
        </property>
        <!--检验值-->
        <property sourceName="lis_value" targetName="ls_lis_value" valueType="String"></property>
        <property sourceName="lis_result" targetName="ls_lis_result" valueType="String"></property>
        <property sourceName="lis_code" targetName="ls_lis_generic_code"  valueType="String"></property>
        <!--格式化后的检验值,为了方便比较-->
        <property sourceName="lis_value" targetName="ls_lis_formatvalue" valueType="String">
            <valueFormatConvertor methodName="formatValue">
                <parameter>lis_value</parameter>
            </valueFormatConvertor>
        </property>
        <!--检验时间-->
        <property sourceName="lis_date" targetName="ls_lis_datetime" valueType="String">
            <dateConcat2Convertor methodName="concat2Datetime">
                <dateParameter value="lis_date" format="yyyymmdd"></dateParameter>
                <timeParameter value="lis_time" format="hhmmss"></timeParameter>
            </dateConcat2Convertor>
        </property>

        <!--检验医嘱名称 -->
        <property sourceName="lis_ordcode" targetName="ls_lis_ordname">
            <dicConvertor methodName="getByCode" dicType="OrderItem">
                <parameter>lis_ordcode</parameter>
            </dicConvertor>
        </property>
        <!--       检验医嘱代码 -->
        <property sourceName="lis_ordcode" targetName="ls_lis_ordcode"></property>
        <property sourceName="lis_ordcode" targetName="ls_code"></property>
    </propertys>

    <outputs>
        <output>
            <elasticsearch index="csmsearch" type="doc"></elasticsearch>
        </output>
    </outputs>
</elasticMapper>