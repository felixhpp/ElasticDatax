<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE elasticMapper SYSTEM "elasticmapping.dtd">
<elasticMapper name="medicalrecord" desc="导入就诊信息数据" business="mr">
    <propertys>
        <property sourceName="mr_admid"  targetName="admno" valueType="String" rowKey="true" idField="true" desc="就诊号">
        </property>
        <property sourceName="mr_regno" targetName="regno" valueType="String" routingField="true" parentField="true" desc="登记号">
        </property>
        <!--就诊时年龄， 需要通过生日字段mr_birthday计算-->
        <property sourceName="mr_birthday" targetName="mr_adm_age" valueType="String"  desc="就诊时年龄">
            <calculateConvertor methodName="differentYears">
                <startDateParameter value="mr_birthday"></startDateParameter>
                <endDateParameter value="mr_admdate"></endDateParameter>
            </calculateConvertor>
        </property>
        <property sourceName="mr_admhospital_code" targetName="mr_adm_admhospital" valueType="String">
            <dicConvertor methodName="getByCode" dicType="Hospital">
                <parameter>mr_admhospital_code</parameter>
            </dicConvertor>
        </property>
        <property sourceName="mr_admtype_code" targetName="mr_adm_type" valueType="String">
            <dicConvertor methodName="getByCode" dicType="AdmType">
                <parameter></parameter>
            </dicConvertor>
        </property>
        <!--就诊日期时间-->
        <property sourceName="mr_admdate" targetName="mr_adm_datetime" valueType="String">
            <dateConcatConvertor methodName="concatDatetime">
                <dateParameter value="mr_admdate" format="shortDate"></dateParameter>
                <timeParameter value="mr_admtime" format="time"></timeParameter>
            </dateConcatConvertor>
        </property>
        <property sourceName="mr_admdept_code" targetName="mr_adm_dept_name" valueType="String">
            <dicConvertor methodName="getByCode" dicType="Deptartment">
                <parameter></parameter>
            </dicConvertor>
        </property>
        <property sourceName="mr_admdept_code" targetName="mr_adm_generic_dept_code" valueType="String">
        </property>
        <property sourceName="mr_dischdate" targetName="mr_adm_dish_datetime" valueType="String">
            <dateConcatConvertor methodName="concatDatetime">
                <dateParameter value="mr_dischdate" format="shortDate"></dateParameter>
                <timeParameter value="mr_dischtime" format="time"></timeParameter>
            </dateConcatConvertor>
        </property>
        <property sourceName="mr_dischdept_code" targetName="mr_adm_dish_dept_name" valueType="String">
            <dicConvertor methodName="getByCode" dicType="Deptartment">
                <parameter></parameter>
            </dicConvertor>
        </property>
        <!--住院天数-->
        <property sourceName="mr_inpatientdays" targetName="mr_adm_inpatientdays" valueType="String">
        </property>
        <!--就诊状态-->
        <property sourceName="mr_visitstatus_code" targetName="mr_adm_visitstatus" valueType="String">
            <dicConvertor methodName="getByCode" dicType="AdmStatus">
                <parameter></parameter>
            </dicConvertor>
        </property>
    </propertys>

    <outputs>
        <output>
            <elasticsearch index="csmsearch" type="doc"></elasticsearch>
        </output>
    </outputs>
</elasticMapper>