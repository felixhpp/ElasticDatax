<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE elasticMapper SYSTEM "elasticmapping.dtd">
<elasticMapper name="diagnose" desc="导入诊断数据" business="da">
    <propertys>
        <property sourceName="diag_id"  targetName="da_diag_id" valueType="String" idField="true"></property>
        <property sourceName="diag_admid" targetName="admno" valueType="String" rowKey="true" parentField="true"></property>
        <property sourceName="diag_regno" targetName="regno"  valueType="String" routingField="true"></property>
        <property sourceName="diag_date" targetName="da_diag_time" valueType="String">
            <dateConcatConvertor methodName="concatDatetime">
                <dateParameter value="diag_date" format="shortDate"></dateParameter>
                <timeParameter value="diag_time" format="time"></timeParameter>
            </dateConcatConvertor>
        </property>
        <property sourceName="diag_type_code" targetName="da_diag_type" valueType="String">
            <dicConvertor methodName="getByCode" dicType="DiagnoseType">
                <parameter></parameter>
            </dicConvertor>
        </property>
        <!--诊断名称  通过编码获取-->
        <property sourceName="diag_name" targetName="da_diag_name" valueType="String">
            <if field="diag_name" test="isEmpty">
                <dicConvertor methodName="getByCode" dicType="DiagnoseName">
                    <parameter>diag_code</parameter>
                </dicConvertor>
            </if>
        </property>
        <!--诊断编码-->
        <property sourceName="diag_code" targetName="da_diag_code" valueType="String"></property>
        <!--诊断顺位-->
        <property sourceName="diag_no" targetName="da_diag_no" valueType="String"></property>
    </propertys>

    <filters>
        <sourceFilter>
            <should>
                <filter filterName="diag_name" filterMethod="isNotEmpty"></filter>
                <filter filterName="diag_code" filterMethod="isNotEmpty"></filter>
            </should>
        </sourceFilter>
    </filters>

    <outputs>
        <output>
            <elasticsearch index="csmsearch" type="doc"></elasticsearch>
        </output>
        <output>
            <mapperFile fileName="diagnoseforstatistics.xml"></mapperFile>
        </output>
    </outputs>
</elasticMapper>